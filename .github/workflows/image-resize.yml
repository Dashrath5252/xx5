name: Auto Image Resize (Root Images)

on:
  workflow_dispatch:
  push:
    paths:
      - "*.webp"
      - "*.jpg"
      - "*.jpeg"
      - "*.png"

jobs:
  resize:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install ImageMagick
      run: sudo apt-get update && sudo apt-get install imagemagick -y

    - name: Generate images
      run: |
        mkdir -p images/generated

        for img in *.webp *.jpg *.jpeg *.png; do
          [ -e "$img" ] || continue

          name="${img%.*}"

          convert "$img" -resize 300 images/generated/${name}-300.webp
          convert "$img" -resize 768 images/generated/${name}-768.webp
          convert "$img" -resize 1200 images/generated/${name}-1200.webp

          convert "$img" -thumbnail 300x300^ -gravity center -extent 300x300 images/generated/${name}-300square.webp
        done

    - name: Commit generated images
      run: |
        git config user.name "github-actions"
        git config user.email "actions@github.com"
        git add images/generated
        git commit -m "Auto generate image sizes (root images)" || echo "Nothing to commit"
        git push
